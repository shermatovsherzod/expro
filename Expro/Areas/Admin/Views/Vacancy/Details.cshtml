@model Expro.ViewModels.VacancyDetailsVM
@using Expro.Models.Enums
@{
    ViewData["Title"] = "Details";
    ViewData["ApprovedStatusAlertText"] = "Вакансия подтверждена";
    ViewData["RejectedStatusAlertText"] = "Вакансия отменена";
}

<h1>Details</h1>

<div>
    <h4>VacancyDetailsVM</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.ID)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.ID)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Company)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Company)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Region)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Region)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.City)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.City)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.CityOther)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.CityOther)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Position)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Position)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Responsibility)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Responsibility)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Requirements)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Requirements)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Salary)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Salary)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Contacts)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Contacts)
        </dd>

        <dt class="col-sm-2">
            Действия:
        </dt>
        <dd class="col-sm-10">
            @if (Model.Status == (int)VacancyStatusEnum.WaitingForApproval)
            {
                <button type="button" class="btn btn-success" onclick="Approve(@Model.ID);">Подтвердить</button>
                <button type="button" class="btn btn-danger" onclick="Reject(@Model.ID);">Отменить</button>
            }
            else if (Model.Status == (int)VacancyStatusEnum.Approved)
            {
                <div class="alert alert-success">@ViewData["ApprovedStatusAlertText"]</div>
            }
            else if (Model.Status == (int)VacancyStatusEnum.Rejected)
            {
                <div class="alert alert-danger">@ViewData["RejectedStatusAlertText"]</div>
            }
            <div class="spinner-border spinner" style="display: none;"></div>
        </dd>
    </dl>
</div>
<div>
    <a asp-action="Index">Back to List</a>
</div>


<script>
    function Approve(id) {

        if (confirm("Вы уверены, что хотите подтвердить?")) {
            $.ajax({
                type: "POST",
                url: "/Admin/Vacancy/Approve/" + id,               
                contentType: "application/json; charset=utf-8",                
                beforeSend: function (data) {
                    $(".btn").attr("disabled", "disabled");
                    ShowFormSpinner();
                },
                success: function (data) {                    
                    location.reload();
                },
                error: function (data) {
                    alert("Ajax error (status code = " + data.status + "): " + data.statusText);
                },
                complete: function (data) {
                }
            });
        }
    }

    function Reject(id) {
        if (confirm("Вы уверены, что хотите отказать?")) {
            $.ajax({
                type: "POST",
                url: "/Admin/Vacancy/Reject/" + id,
                contentType: "application/json; charset=utf-8",
                beforeSend: function (data) {
                    $(".btn").attr("disabled", "disabled");
                    ShowFormSpinner();
                },
                success: function (data) {
                    location.reload();
                },
                error: function (data) {
                    alert("Ajax error (status code = " + data.status + "): " + data.statusText);
                },
                complete: function (data) {
                }
            });
        }
    }

   
   

    function ShowFormSpinner() {
        $(".spinner").show();
    }
</script>